<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Event Tools</title>
</head>
<body>
    <div class="hamburger-menu left">
        <button class="hamburger-btn" onclick="toggleMenu()">&#9776;</button>
        <div id="menuDropdown" class="sidebar-menu">
            <button onclick="showNewEventModal()" class="sidebar-item">New Event</button>
            <button onclick="showCustomizeModal()" class="sidebar-item">Customize</button>
            <button onclick="showSettingsModal()" class="sidebar-item">Settings</button>
        </div>
    </div>

    <div id="newEventModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-title">Start New Event?</div>
            <div class="modal-text">This will clear all teams, scores, and schedule data.</div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="confirmNewEvent()">Yes, Start Fresh</button>
                <button class="btn btn-secondary" onclick="closeNewEventModal()">Cancel</button>
            </div>
        </div>
    </div>

    <div id="customizeModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-title">Customize</div>
            <div class="customize-options">
                <div class="customize-group">
                    <label>Accent Color</label>
                    <div class="color-options">
                        <button class="color-swatch" style="background: #58a6ff;" onclick="setAccentColor('#58a6ff')" data-color="#58a6ff"></button>
                        <button class="color-swatch" style="background: #f78166;" onclick="setAccentColor('#f78166')" data-color="#f78166"></button>
                        <button class="color-swatch" style="background: #a371f7;" onclick="setAccentColor('#a371f7')" data-color="#a371f7"></button>
                        <button class="color-swatch" style="background: #3fb950;" onclick="setAccentColor('#3fb950')" data-color="#3fb950"></button>
                        <button class="color-swatch" style="background: #f0883e;" onclick="setAccentColor('#f0883e')" data-color="#f0883e"></button>
                        <button class="color-swatch" style="background: #db61a2;" onclick="setAccentColor('#db61a2')" data-color="#db61a2"></button>
                    </div>
                </div>
                <div class="customize-group">
                    <label>Font Size</label>
                    <div class="font-size-options">
                        <button class="btn btn-secondary font-size-btn" onclick="setFontSize('small')" data-size="small">Small</button>
                        <button class="btn btn-secondary font-size-btn" onclick="setFontSize('medium')" data-size="medium">Medium</button>
                        <button class="btn btn-secondary font-size-btn" onclick="setFontSize('large')" data-size="large">Large</button>
                    </div>
                </div>
                <div class="customize-group">
                    <label>Theme</label>
                    <div class="theme-options">
                        <button class="btn btn-secondary theme-btn" onclick="setTheme('dark')" data-theme="dark">Dark</button>
                        <button class="btn btn-secondary theme-btn" onclick="setTheme('light')" data-theme="light">Light</button>
                    </div>
                </div>
            </div>
            <div class="modal-buttons" style="margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="closeCustomizeModal()">Done</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-title">Settings</div>
            <div class="customize-options">
                <div class="customize-group">
                    <div class="setting-row">
                        <label>Sound Effects</label>
                        <button class="toggle-btn" id="soundToggle" onclick="toggleSetting('sound')">
                            <span class="toggle-slider"></span>
                        </button>
                    </div>
                </div>
                <div class="customize-group">
                    <div class="setting-row">
                        <label>Vibration</label>
                        <button class="toggle-btn" id="vibrationToggle" onclick="toggleSetting('vibration')">
                            <span class="toggle-slider"></span>
                        </button>
                    </div>
                </div>
                <div class="customize-group">
                    <div class="setting-row">
                        <label>Confirm before clearing</label>
                        <button class="toggle-btn" id="confirmToggle" onclick="toggleSetting('confirm')">
                            <span class="toggle-slider"></span>
                        </button>
                    </div>
                </div>
                <div class="customize-group">
                    <div class="setting-row">
                        <label>AI Assistant</label>
                        <button class="toggle-btn" id="aiToggle" onclick="toggleAI()">
                            <span class="toggle-slider"></span>
                        </button>
                    </div>
                </div>
                <div class="customize-group" style="border-top: 1px solid var(--border); padding-top: 1rem; margin-top: 0.5rem;">
                    <label>Data</label>
                    <div class="flex gap-2 mt-2">
                        <button class="btn btn-secondary" onclick="exportData()" style="flex: 1;">Export</button>
                        <button class="btn btn-secondary" onclick="importData()" style="flex: 1;">Import</button>
                    </div>
                </div>
            </div>
            <div class="modal-buttons" style="margin-top: 1.5rem;">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">Done</button>
            </div>
        </div>
    </div>

    <input type="file" id="importInput" accept=".json" style="display: none;" onchange="handleImport(event)">

    <div class="container flex flex-col items-center" style="justify-content: center; min-height: 100vh;">
        <h1>Event tools</h1>
        <p class="text-muted mb-4">Tools for events</p>
        <div class="flex gap-2" style="flex-wrap: wrap; justify-content: center;">
            <button class="btn btn-primary" onclick="window.location.href='teamgen.html'">Team Generator</button>
            <button class="btn btn-primary" onclick="window.location.href='scoring.html'">Scoring</button>
            <button class="btn btn-primary" onclick="window.location.href='timer.html'">Timer</button>
            <button class="btn btn-primary" onclick="window.location.href='schedule.html'">Schedule</button>
            <button class="btn btn-primary" onclick="window.location.href='picker.html'">Random Picker</button>
            <button class="btn btn-primary" onclick="window.location.href='notes.html'">Notes</button>
            <button class="btn btn-primary" id="aiBtn" onclick="window.location.href='ai.html'" style="display: none;">AI Assistant</button>
        </div>
        <button class="btn btn-secondary mt-4" onclick="playAttention()" style="padding: 1rem 2rem;">
            Attention
        </button>
    </div>

    <script>

        function toggleMenu() {
            const menu = document.getElementById('menuDropdown');
            if (menu.classList.contains('open')) {
                menu.classList.remove('open');
                document.body.style.overflow = '';
            } else {
                menu.classList.add('open');
                document.body.style.overflow = 'hidden';
            }
        }

        // Close sidebar when clicking outside or on menu item
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('menuDropdown');
            const hamburger = e.target.closest('.hamburger-menu');
            if (!hamburger && menu.classList.contains('open')) {
                menu.classList.remove('open');
                document.body.style.overflow = '';
            }
        });
        // Also close sidebar when clicking a menu item
        document.querySelectorAll('.sidebar-item').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('menuDropdown').classList.remove('open');
                document.body.style.overflow = '';
            });
        });

        function showNewEventModal() {
            document.getElementById('newEventModal').style.display = 'flex';
        }

        function closeNewEventModal() {
            document.getElementById('newEventModal').style.display = 'none';
        }

        function confirmNewEvent() {
            localStorage.removeItem('eventToolsTeams');
            localStorage.removeItem('eventToolsScoring');
            localStorage.removeItem('eventToolsSchedule');
            localStorage.removeItem('eventToolsPicker');
            closeNewEventModal();
        }

        function showCustomizeModal() {
            document.getElementById('customizeModal').style.display = 'flex';
            updateCustomizeSelection();
        }

        function closeCustomizeModal() {
            document.getElementById('customizeModal').style.display = 'none';
        }

        function setAccentColor(color) {
            document.documentElement.style.setProperty('--accent', color);
            localStorage.setItem('eventToolsAccent', color);
            updateCustomizeSelection();
        }

        function setFontSize(size) {
            const sizes = { small: '14px', medium: '16px', large: '18px' };
            document.documentElement.style.setProperty('--base-font-size', sizes[size]);
            localStorage.setItem('eventToolsFontSize', size);
            updateCustomizeSelection();
        }

        function setTheme(theme) {
            if (theme === 'light') {
                document.documentElement.style.setProperty('--bg-primary', '#ffffff');
                document.documentElement.style.setProperty('--bg-secondary', '#f6f8fa');
                document.documentElement.style.setProperty('--bg-tertiary', '#eaeef2');
                document.documentElement.style.setProperty('--text-primary', '#1f2328');
                document.documentElement.style.setProperty('--text-secondary', '#656d76');
                document.documentElement.style.setProperty('--text-muted', '#8b949e');
                document.documentElement.style.setProperty('--border', '#d0d7de');
            } else {
                document.documentElement.style.setProperty('--bg-primary', '#0d1117');
                document.documentElement.style.setProperty('--bg-secondary', '#161b22');
                document.documentElement.style.setProperty('--bg-tertiary', '#21262d');
                document.documentElement.style.setProperty('--text-primary', '#e6edf3');
                document.documentElement.style.setProperty('--text-secondary', '#8b949e');
                document.documentElement.style.setProperty('--text-muted', '#6e7681');
                document.documentElement.style.setProperty('--border', '#30363d');
            }
            localStorage.setItem('eventToolsTheme', theme);
            updateCustomizeSelection();
        }

        function updateCustomizeSelection() {
            const accent = localStorage.getItem('eventToolsAccent') || '#58a6ff';
            const fontSize = localStorage.getItem('eventToolsFontSize') || 'medium';
            const theme = localStorage.getItem('eventToolsTheme') || 'dark';

            document.querySelectorAll('.color-swatch').forEach(el => {
                el.classList.toggle('active', el.dataset.color === accent);
            });
            document.querySelectorAll('.font-size-btn').forEach(el => {
                el.classList.toggle('active', el.dataset.size === fontSize);
            });
            document.querySelectorAll('.theme-btn').forEach(el => {
                el.classList.toggle('active', el.dataset.theme === theme);
            });
        }

        function loadCustomization() {
            const accent = localStorage.getItem('eventToolsAccent');
            const fontSize = localStorage.getItem('eventToolsFontSize');
            const theme = localStorage.getItem('eventToolsTheme');
            if (accent) setAccentColor(accent);
            if (fontSize) setFontSize(fontSize);
            if (theme) setTheme(theme);
        }

        loadCustomization();

        function showSettingsModal() {
            document.getElementById('settingsModal').style.display = 'flex';
            updateSettingsToggles();
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function toggleSetting(setting) {
            const key = `eventTools_${setting}`;
            const current = localStorage.getItem(key) !== 'false';
            localStorage.setItem(key, !current);
            updateSettingsToggles();
        }

        function updateSettingsToggles() {
            const settings = ['sound', 'vibration', 'confirm'];
            settings.forEach(setting => {
                const enabled = localStorage.getItem(`eventTools_${setting}`) !== 'false';
                const toggle = document.getElementById(`${setting}Toggle`);
                if (toggle) toggle.classList.toggle('active', enabled);
            });
            
            const aiEnabled = localStorage.getItem('eventTools_ai') === 'true';
            const aiToggle = document.getElementById('aiToggle');
            if (aiToggle) aiToggle.classList.toggle('active', aiEnabled);
        }

        function toggleAI() {
            const current = localStorage.getItem('eventTools_ai') === 'true';
            localStorage.setItem('eventTools_ai', !current);
            updateSettingsToggles();
            updateAIButton();
        }

        function updateAIButton() {
            const aiEnabled = localStorage.getItem('eventTools_ai') === 'true';
            const aiBtn = document.getElementById('aiBtn');
            if (aiBtn) aiBtn.style.display = aiEnabled ? 'inline-block' : 'none';
        }

        updateAIButton();

        function getSettings() {
            return {
                sound: localStorage.getItem('eventTools_sound') !== 'false',
                vibration: localStorage.getItem('eventTools_vibration') !== 'false',
                confirm: localStorage.getItem('eventTools_confirm') !== 'false'
            };
        }

        function exportData() {
            const data = {
                teams: localStorage.getItem('eventToolsTeams'),
                scoring: localStorage.getItem('eventToolsScoring'),
                schedule: localStorage.getItem('eventToolsSchedule'),
                notes: localStorage.getItem('eventToolsNotes'),
                settings: {
                    accent: localStorage.getItem('eventToolsAccent'),
                    fontSize: localStorage.getItem('eventToolsFontSize'),
                    theme: localStorage.getItem('eventToolsTheme'),
                    sound: localStorage.getItem('eventTools_sound'),
                    vibration: localStorage.getItem('eventTools_vibration'),
                    confirm: localStorage.getItem('eventTools_confirm')
                }
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `event-tools-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('importInput').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.teams) localStorage.setItem('eventToolsTeams', data.teams);
                    if (data.scoring) localStorage.setItem('eventToolsScoring', data.scoring);
                    if (data.schedule) localStorage.setItem('eventToolsSchedule', data.schedule);
                    if (data.notes) localStorage.setItem('eventToolsNotes', data.notes);
                    if (data.settings) {
                        if (data.settings.accent) localStorage.setItem('eventToolsAccent', data.settings.accent);
                        if (data.settings.fontSize) localStorage.setItem('eventToolsFontSize', data.settings.fontSize);
                        if (data.settings.theme) localStorage.setItem('eventToolsTheme', data.settings.theme);
                        if (data.settings.sound) localStorage.setItem('eventTools_sound', data.settings.sound);
                        if (data.settings.vibration) localStorage.setItem('eventTools_vibration', data.settings.vibration);
                        if (data.settings.confirm) localStorage.setItem('eventTools_confirm', data.settings.confirm);
                    }
                    loadCustomization();
                    alert('Data imported successfully!');
                } catch (err) {
                    alert('Invalid backup file');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function playAttention() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }, i * 400);
            }
            
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }
    </script>
</body>
</html>